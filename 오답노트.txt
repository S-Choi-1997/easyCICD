================================================================================
ë°°í¬ í™˜ê²½ ì˜¤ë¥˜ ë° í•´ê²° - ìµœì¢… ì •ë¦¬
================================================================================

âŒ ë¬¸ì œ 1: SQLite ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ìƒì„± ì‹¤íŒ¨
--------------------------------------------------------------------------------
ì›ì¸: SQLxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
ì—ëŸ¬: error returned from database: (code: 14) unable to open database file
í•´ê²°: SqliteConnectOptions::create_if_missing(true) ì¶”ê°€
ì½”ë“œ: agent/src/db/queries.rs:12-14

âŒ ë¬¸ì œ 2: ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ ì¶©ëŒ
--------------------------------------------------------------------------------
ì›ì¸: /data/db/ ë””ë ‰í† ë¦¬ì™€ /data/db.sqlite íŒŒì¼ëª… ì¶©ëŒ
ì‹œë„1: /data/db.sqlite â†’ ì‹¤íŒ¨ (ê¸°ì¡´ /data/db/ ë””ë ‰í† ë¦¬ì™€ ì¶©ëŒ)
ì‹œë„2: /data/db/easycicd.db â†’ ì‹¤íŒ¨ (ë””ë ‰í† ë¦¬ êµ¬ì¡° í˜¼ë€)
í•´ê²°: ì „ìš© ë””ë ‰í† ë¦¬ ìƒì„± /data/easycicd/db.sqlite
ì¶”ê°€: main.rsì— std::fs::create_dir_all("/data/easycicd") ì¶”ê°€

âŒ ë¬¸ì œ 3: Axum 0.7 ë¼ìš°íŒ… ë¬¸ë²• ë³€ê²½
--------------------------------------------------------------------------------
ì›ì¸: Axumì´ 0.7ì—ì„œ ê²½ë¡œ íŒŒë¼ë¯¸í„° ë¬¸ë²• ë³€ê²½
ì—ëŸ¬: Path segments must not start with `:`. For capture groups, use `{capture}`
í•´ê²°: :id â†’ {id} ë³€ê²½
íŒŒì¼: agent/src/api/projects.rs:20-21, agent/src/api/builds.rs:16

âŒ ë¬¸ì œ 4: Axum 0.7 ì •ì  íŒŒì¼ ì„œë¹™ ë³€ê²½
--------------------------------------------------------------------------------
ì›ì¸: Axum 0.7ì—ì„œ ë£¨íŠ¸ ê²½ë¡œ nest_service ê¸ˆì§€
ì—ëŸ¬: Nesting at the root is no longer supported. Use fallback_service instead
í•´ê²°: .nest_service("/", ...) â†’ .fallback_service(...)
íŒŒì¼: agent/src/main.rs:71

âŒ ë¬¸ì œ 5: GLIBC ë²„ì „ ë¶ˆì¼ì¹˜
--------------------------------------------------------------------------------
ì›ì¸: ë¹Œë“œ ë‹¨ê³„(Trixie)ì™€ ëŸ°íƒ€ì„ ë‹¨ê³„(Bookworm)ì˜ GLIBC ë²„ì „ ì°¨ì´
ì—ëŸ¬: /lib/x86_64-linux-gnu/libc.so.6: version 'GLIBC_2.39' not found
í•´ê²°: ëŸ°íƒ€ì„ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ debian:trixie-slimìœ¼ë¡œ ë³€ê²½
íŒŒì¼: agent/Dockerfile:29

âŒ ë¬¸ì œ 6: ì •ì  íŒŒì¼ ê²½ë¡œ ì˜¤ë¥˜
--------------------------------------------------------------------------------
ì›ì¸: ì‘ì—… ë””ë ‰í† ë¦¬ê°€ /appì¸ë° ../frontend ì°¸ì¡° ì‹œ /frontendê°€ ë¨
ì‹¤ì œ: /app/frontend ë””ë ‰í† ë¦¬ê°€ ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¨
í•´ê²°: "../frontend" â†’ "frontend" ë³€ê²½
íŒŒì¼: agent/src/main.rs:71

âŒ ë¬¸ì œ 7: nginx ì„¤ì • - daemon directive ì¤‘ë³µ
--------------------------------------------------------------------------------
ì›ì¸: nginx.confì— "daemon off;" í¬í•¨, runtime_commandì—ë„ "-g 'daemon off;'" í¬í•¨
ì—ëŸ¬: nginx: [emerg] "daemon" directive is duplicate in /app/nginx.conf:1
ì˜í–¥: Runtime ì»¨í…Œì´ë„ˆê°€ ê³„ì† ì¬ì‹œì‘í•˜ë©° í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
í•´ê²°:
  1. nginx.confì—ë§Œ "daemon off;" ìœ ì§€
  2. runtime_commandì—ì„œ "-g 'daemon off;'" ì œê±°
  3. detector.rsì˜ ëª¨ë“  nginx ê´€ë ¨ ì„¤ì • ìˆ˜ì •
íŒŒì¼:
  - agent/src/github/detector.rs:125 (Node.js Frontend)
  - agent/src/github/detector.rs:224 (Static Site)
  - agent/src/github/detector.rs:425 (ê¸°ì¡´ì— ìˆ˜ì •ëœ ê³³)

âŒ ë¬¸ì œ 8: Docker ë„¤íŠ¸ì›Œí¬ í†µì‹  ì‹¤íŒ¨ - localhost ì‚¬ìš©
--------------------------------------------------------------------------------
ì›ì¸: Agentì™€ Runtime ì»¨í…Œì´ë„ˆê°€ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ê´€ì ì—ì„œ localhost ì‚¬ìš©
ë°°ê²½:
  - Agent ì»¨í…Œì´ë„ˆ: easycicd_easycicd ë„¤íŠ¸ì›Œí¬ (gateway: 172.19.0.1)
  - Runtime ì»¨í…Œì´ë„ˆ: ì²˜ìŒì—ëŠ” ë³„ë„ ë„¤íŠ¸ì›Œí¬
  - í—¬ìŠ¤ì²´í¬/í”„ë¡ì‹œì—ì„œ localhost ì‚¬ìš© ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´

ë¬¸ì œ 8-1: í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
ì—ëŸ¬: Health check failed - error sending request for url (http://localhost:10001/health)
ì›ì¸: Agentê°€ localhost:10001 í˜¸ì¶œ ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´
ì‹œë„1: 172.17.0.1 ì‚¬ìš© â†’ ì‹¤íŒ¨ (bridge ë„¤íŠ¸ì›Œí¬, agentëŠ” easycicd ë„¤íŠ¸ì›Œí¬)
ì‹œë„2: host ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ â†’ ì‹¤íŒ¨ (í¬íŠ¸ ë°”ì¸ë”© ì•ˆë¨)
í•´ê²°:
  1. Runtime ì»¨í…Œì´ë„ˆë¥¼ easycicd_easycicd ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°
  2. Gateway IP (172.19.0.1) ìë™ ê°ì§€
  3. í—¬ìŠ¤ì²´í¬ì—ì„œ gateway_ip ì‚¬ìš©
íŒŒì¼:
  - agent/src/docker/client.rs:60-72 (gateway IP ê°ì§€)
  - agent/src/docker/client.rs:293-304 (ë„¤íŠ¸ì›Œí¬ ì—°ê²°)
  - agent/src/build/deployer.rs:226-227 (í—¬ìŠ¤ì²´í¬ URL)

ë¬¸ì œ 8-2: í”„ë¡ì‹œ ì—°ê²° ì‹¤íŒ¨
ì—ëŸ¬: Failed to proxy request: error sending request for url (http://localhost:10001/)
ì›ì¸: Reverse proxyì—ì„œ localhost:10001 í˜¸ì¶œ ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´
í•´ê²°:
  1. AppStateì— gateway_ip í•„ë“œ ì¶”ê°€
  2. main.rsì—ì„œ DockerClient ì´ˆê¸°í™” í›„ gateway_ip ì¶”ì¶œ
  3. í”„ë¡ì‹œ ë¼ìš°í„°ì—ì„œ gateway_ip ì‚¬ìš©
íŒŒì¼:
  - agent/src/state.rs:16 (gateway_ip í•„ë“œ ì¶”ê°€)
  - agent/src/state.rs:20 (ìƒì„±ì íŒŒë¼ë¯¸í„° ì¶”ê°€)
  - agent/src/main.rs:63-64 (DockerClient ì´ˆê¸°í™”)
  - agent/src/proxy/router.rs:89-92 (gateway_ip ì‚¬ìš©)

ë„¤íŠ¸ì›Œí¬ êµ¬ì¡° ì´í•´:
  - Cloudflare Tunnel â†’ 172.17.0.1:9999 (ë˜ëŠ” 172.19.0.1:9999)
  - í¬íŠ¸ ë°”ì¸ë”©: 0.0.0.0:9999â†’8080 (ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
  - Agent ë‚´ë¶€: 172.19.0.1:10001ë¡œ í”„ë¡ì‹œ (ê°™ì€ ë„¤íŠ¸ì›Œí¬ ë‚´ í†µì‹ )
  - Runtime ì»¨í…Œì´ë„ˆ: easycicd_easycicd + bridge ë„¤íŠ¸ì›Œí¬ (ë©€í‹° ë„¤íŠ¸ì›Œí¬)

âœ… ìµœì¢… í•´ê²° ì‚¬í•­
--------------------------------------------------------------------------------
1. SQLite ìë™ ìƒì„±: create_if_missing(true)
2. ë°ì´í„° ê²½ë¡œ: /data/easycicd/db.sqlite, /data/easycicd/logs/
3. Axum ë¼ìš°íŒ…: {id} ë¬¸ë²•, fallback_service ì‚¬ìš©
4. GLIBC í†µì¼: debian:trixie-slim
5. ì •ì  íŒŒì¼: frontend ìƒëŒ€ ê²½ë¡œ
6. í¬íŠ¸ ì„¤ì •: ì›¹ UI 10000, ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ 9999, í”„ë¡œì íŠ¸ 10000ë¶€í„° ì‹œì‘
7. nginx ì„¤ì •: daemon offëŠ” nginx.confì—ë§Œ
8. ë„¤íŠ¸ì›Œí¬ í†µì‹ : Gateway IP (172.19.0.1) ìë™ ê°ì§€ ë° ì‚¬ìš©
9. Runtime ë„¤íŠ¸ì›Œí¬: easycicd_easycicd ë„¤íŠ¸ì›Œí¬ ì—°ê²°
10. ëª¨ë…¸ë ˆí¬ working_directory: path_filterë¡œë¶€í„° ì¶”ì¶œ, ë¹Œë“œ ì»¨í…Œì´ë„ˆ WORKDIR ë™ì  ì„¤ì •

ğŸš€ ë°°í¬ ì™„ë£Œ
--------------------------------------------------------------------------------
Docker Hub: choho97/lightweight-ci:latest (sha256:319e581d0b94...)
Git Commit: (ìµœì‹ )
ì»¨í…Œì´ë„ˆ: ì •ìƒ ì‹¤í–‰ ì¤‘
í—¬ìŠ¤ì²´í¬: ì„±ê³µ (http://172.19.0.1:10001/health)
í”„ë¡ì‹œ: ì •ìƒ ì‘ë™ (http://172.19.0.1:10001/)

ğŸ“‹ ì‹¤í–‰ ë°©ë²•
--------------------------------------------------------------------------------
1. docker-compose up -d
2. http://localhost:10000 ì ‘ì† (ì›¹ UI)
3. http://localhost:9999/{project_name} (ë°°í¬ëœ ì•±)
4. GET /api/settings/webhook-secretë¡œ Webhook Secret í™•ì¸

ğŸ” ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ëª…ë ¹ì–´
--------------------------------------------------------------------------------
# Gateway IP í™•ì¸
docker network inspect easycicd_easycicd | jq '.[0].IPAM.Config[0].Gateway'

# Agent IP í™•ì¸
docker inspect easycicd-agent | jq '.[0].NetworkSettings.Networks.easycicd_easycicd.IPAddress'

# Runtime ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker inspect tt-green | jq '.[0].NetworkSettings.Networks | keys'

# í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸
curl http://localhost:9999/tt/
