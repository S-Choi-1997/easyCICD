================================================================================
ë°°í¬ í™˜ê²½ ì˜¤ë¥˜ ë° í•´ê²° - ìµœì¢… ì •ë¦¬
================================================================================

âŒ ë¬¸ì œ 1: SQLite ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ìƒì„± ì‹¤íŒ¨
--------------------------------------------------------------------------------
ì›ì¸: SQLxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ì—†ìœ¼ë©´ ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
ì—ëŸ¬: error returned from database: (code: 14) unable to open database file
í•´ê²°: SqliteConnectOptions::create_if_missing(true) ì¶”ê°€
ì½”ë“œ: agent/src/db/queries.rs:12-14

âŒ ë¬¸ì œ 2: ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ ì¶©ëŒ
--------------------------------------------------------------------------------
ì›ì¸: /data/db/ ë””ë ‰í† ë¦¬ì™€ /data/db.sqlite íŒŒì¼ëª… ì¶©ëŒ
ì‹œë„1: /data/db.sqlite â†’ ì‹¤íŒ¨ (ê¸°ì¡´ /data/db/ ë””ë ‰í† ë¦¬ì™€ ì¶©ëŒ)
ì‹œë„2: /data/db/easycicd.db â†’ ì‹¤íŒ¨ (ë””ë ‰í† ë¦¬ êµ¬ì¡° í˜¼ë€)
í•´ê²°: ì „ìš© ë””ë ‰í† ë¦¬ ìƒì„± /data/easycicd/db.sqlite
ì¶”ê°€: main.rsì— std::fs::create_dir_all("/data/easycicd") ì¶”ê°€

âŒ ë¬¸ì œ 3: Axum 0.7 ë¼ìš°íŒ… ë¬¸ë²• ë³€ê²½
--------------------------------------------------------------------------------
ì›ì¸: Axumì´ 0.7ì—ì„œ ê²½ë¡œ íŒŒë¼ë¯¸í„° ë¬¸ë²• ë³€ê²½
ì—ëŸ¬: Path segments must not start with `:`. For capture groups, use `{capture}`
í•´ê²°: :id â†’ {id} ë³€ê²½
íŒŒì¼: agent/src/api/projects.rs:20-21, agent/src/api/builds.rs:16

âŒ ë¬¸ì œ 4: Axum 0.7 ì •ì  íŒŒì¼ ì„œë¹™ ë³€ê²½
--------------------------------------------------------------------------------
ì›ì¸: Axum 0.7ì—ì„œ ë£¨íŠ¸ ê²½ë¡œ nest_service ê¸ˆì§€
ì—ëŸ¬: Nesting at the root is no longer supported. Use fallback_service instead
í•´ê²°: .nest_service("/", ...) â†’ .fallback_service(...)
íŒŒì¼: agent/src/main.rs:71

âŒ ë¬¸ì œ 5: GLIBC ë²„ì „ ë¶ˆì¼ì¹˜
--------------------------------------------------------------------------------
ì›ì¸: ë¹Œë“œ ë‹¨ê³„(Trixie)ì™€ ëŸ°íƒ€ì„ ë‹¨ê³„(Bookworm)ì˜ GLIBC ë²„ì „ ì°¨ì´
ì—ëŸ¬: /lib/x86_64-linux-gnu/libc.so.6: version 'GLIBC_2.39' not found
í•´ê²°: ëŸ°íƒ€ì„ ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¥¼ debian:trixie-slimìœ¼ë¡œ ë³€ê²½
íŒŒì¼: agent/Dockerfile:29

âŒ ë¬¸ì œ 6: ì •ì  íŒŒì¼ ê²½ë¡œ ì˜¤ë¥˜
--------------------------------------------------------------------------------
ì›ì¸: ì‘ì—… ë””ë ‰í† ë¦¬ê°€ /appì¸ë° ../frontend ì°¸ì¡° ì‹œ /frontendê°€ ë¨
ì‹¤ì œ: /app/frontend ë””ë ‰í† ë¦¬ê°€ ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¨
í•´ê²°: "../frontend" â†’ "frontend" ë³€ê²½
íŒŒì¼: agent/src/main.rs:71

âŒ ë¬¸ì œ 7: nginx ì„¤ì • - daemon directive ì¤‘ë³µ
--------------------------------------------------------------------------------
ì›ì¸: nginx.confì— "daemon off;" í¬í•¨, runtime_commandì—ë„ "-g 'daemon off;'" í¬í•¨
ì—ëŸ¬: nginx: [emerg] "daemon" directive is duplicate in /app/nginx.conf:1
ì˜í–¥: Runtime ì»¨í…Œì´ë„ˆê°€ ê³„ì† ì¬ì‹œì‘í•˜ë©° í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
í•´ê²°:
  1. nginx.confì—ë§Œ "daemon off;" ìœ ì§€
  2. runtime_commandì—ì„œ "-g 'daemon off;'" ì œê±°
  3. detector.rsì˜ ëª¨ë“  nginx ê´€ë ¨ ì„¤ì • ìˆ˜ì •
íŒŒì¼:
  - agent/src/github/detector.rs:125 (Node.js Frontend)
  - agent/src/github/detector.rs:224 (Static Site)
  - agent/src/github/detector.rs:425 (ê¸°ì¡´ì— ìˆ˜ì •ëœ ê³³)

âŒ ë¬¸ì œ 8: Docker ë„¤íŠ¸ì›Œí¬ í†µì‹  ì‹¤íŒ¨ - localhost ì‚¬ìš©
--------------------------------------------------------------------------------
ì›ì¸: Agentì™€ Runtime ì»¨í…Œì´ë„ˆê°€ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ê´€ì ì—ì„œ localhost ì‚¬ìš©
ë°°ê²½:
  - Agent ì»¨í…Œì´ë„ˆ: easycicd_easycicd ë„¤íŠ¸ì›Œí¬ (gateway: 172.19.0.1)
  - Runtime ì»¨í…Œì´ë„ˆ: ì²˜ìŒì—ëŠ” ë³„ë„ ë„¤íŠ¸ì›Œí¬
  - í—¬ìŠ¤ì²´í¬/í”„ë¡ì‹œì—ì„œ localhost ì‚¬ìš© ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´

ë¬¸ì œ 8-1: í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
ì—ëŸ¬: Health check failed - error sending request for url (http://localhost:10001/health)
ì›ì¸: Agentê°€ localhost:10001 í˜¸ì¶œ ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´
ì‹œë„1: 172.17.0.1 ì‚¬ìš© â†’ ì‹¤íŒ¨ (bridge ë„¤íŠ¸ì›Œí¬, agentëŠ” easycicd ë„¤íŠ¸ì›Œí¬)
ì‹œë„2: host ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ â†’ ì‹¤íŒ¨ (í¬íŠ¸ ë°”ì¸ë”© ì•ˆë¨)
í•´ê²°:
  1. Runtime ì»¨í…Œì´ë„ˆë¥¼ easycicd_easycicd ë„¤íŠ¸ì›Œí¬ì— ì—°ê²°
  2. Gateway IP (172.19.0.1) ìë™ ê°ì§€
  3. í—¬ìŠ¤ì²´í¬ì—ì„œ gateway_ip ì‚¬ìš©
íŒŒì¼:
  - agent/src/docker/client.rs:60-72 (gateway IP ê°ì§€)
  - agent/src/docker/client.rs:293-304 (ë„¤íŠ¸ì›Œí¬ ì—°ê²°)
  - agent/src/build/deployer.rs:226-227 (í—¬ìŠ¤ì²´í¬ URL)

ë¬¸ì œ 8-2: í”„ë¡ì‹œ ì—°ê²° ì‹¤íŒ¨
ì—ëŸ¬: Failed to proxy request: error sending request for url (http://localhost:10001/)
ì›ì¸: Reverse proxyì—ì„œ localhost:10001 í˜¸ì¶œ ì‹œ ìê¸° ìì‹ ì„ ê°€ë¦¬í‚´
í•´ê²°:
  1. AppStateì— gateway_ip í•„ë“œ ì¶”ê°€
  2. main.rsì—ì„œ DockerClient ì´ˆê¸°í™” í›„ gateway_ip ì¶”ì¶œ
  3. í”„ë¡ì‹œ ë¼ìš°í„°ì—ì„œ gateway_ip ì‚¬ìš©
íŒŒì¼:
  - agent/src/state.rs:16 (gateway_ip í•„ë“œ ì¶”ê°€)
  - agent/src/state.rs:20 (ìƒì„±ì íŒŒë¼ë¯¸í„° ì¶”ê°€)
  - agent/src/main.rs:63-64 (DockerClient ì´ˆê¸°í™”)
  - agent/src/proxy/router.rs:89-92 (gateway_ip ì‚¬ìš©)

ë„¤íŠ¸ì›Œí¬ êµ¬ì¡° ì´í•´:
  - Cloudflare Tunnel â†’ 172.17.0.1:9999 (ë˜ëŠ” 172.19.0.1:9999)
  - í¬íŠ¸ ë°”ì¸ë”©: 0.0.0.0:9999â†’8080 (ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
  - Agent ë‚´ë¶€: 172.19.0.1:10001ë¡œ í”„ë¡ì‹œ (ê°™ì€ ë„¤íŠ¸ì›Œí¬ ë‚´ í†µì‹ )
  - Runtime ì»¨í…Œì´ë„ˆ: easycicd_easycicd + bridge ë„¤íŠ¸ì›Œí¬ (ë©€í‹° ë„¤íŠ¸ì›Œí¬)

âœ… ìµœì¢… í•´ê²° ì‚¬í•­
--------------------------------------------------------------------------------
1. SQLite ìë™ ìƒì„±: create_if_missing(true)
2. ë°ì´í„° ê²½ë¡œ: /data/easycicd/db.sqlite, /data/easycicd/logs/
3. Axum ë¼ìš°íŒ…: {id} ë¬¸ë²•, fallback_service ì‚¬ìš©
4. GLIBC í†µì¼: debian:trixie-slim
5. ì •ì  íŒŒì¼: frontend ìƒëŒ€ ê²½ë¡œ
6. í¬íŠ¸ ì„¤ì •: ì›¹ UI 10000, ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ 9999, í”„ë¡œì íŠ¸ 10000ë¶€í„° ì‹œì‘
7. nginx ì„¤ì •: daemon offëŠ” nginx.confì—ë§Œ
8. ë„¤íŠ¸ì›Œí¬ í†µì‹ : Gateway IP (172.19.0.1) ìë™ ê°ì§€ ë° ì‚¬ìš©
9. Runtime ë„¤íŠ¸ì›Œí¬: easycicd_easycicd ë„¤íŠ¸ì›Œí¬ ì—°ê²°
10. ëª¨ë…¸ë ˆí¬ working_directory: path_filterë¡œë¶€í„° ì¶”ì¶œ, ë¹Œë“œ ì»¨í…Œì´ë„ˆ WORKDIR ë™ì  ì„¤ì •

âŒ ë¬¸ì œ 9: ëª¨ë…¸ë ˆí¬ ë¹Œë“œ ì‹¤íŒ¨ - working_directory DB ì €ì¥ ëˆ„ë½
--------------------------------------------------------------------------------
ì›ì¸: queries.rsì˜ INSERT ì¿¼ë¦¬ì— working_directory ì»¬ëŸ¼ ë° ë°”ì¸ë”© íŒŒë¼ë¯¸í„° ëˆ„ë½
ì¦ìƒ:
  - Gradle: "Directory '/app' does not contain a Gradle build"
  - npm: "ENOENT: no such file or directory, open '/app/package.json'"
  - ëª¨ë…¸ë ˆí¬ í”„ë¡œì íŠ¸ì—ì„œ path_filter="project1" ì„¤ì •í–ˆìœ¼ë‚˜ ë¹Œë“œëŠ” /appì—ì„œ ì‹¤í–‰ë¨

ê·¼ë³¸ ì›ì¸:
  1. í”„ë¡ íŠ¸ì—”ë“œ(Setup.svelte)ì—ì„œ working_directory ì „ì†¡ O
  2. API(projects.rs)ì—ì„œ working_directory ìˆ˜ì‹  O
  3. CreateProject êµ¬ì¡°ì²´ì— working_directory í•„ë“œ O
  4. INSERT ì¿¼ë¦¬ì— working_directory ì»¬ëŸ¼ X â† ë¬¸ì œ
  5. ê²°ê³¼: ëª¨ë“  í”„ë¡œì íŠ¸ working_directory = NULL
  6. ë¹Œë“œ ì»¨í…Œì´ë„ˆëŠ” í•­ìƒ /appì—ì„œ ì‹¤í–‰
  7. ëª¨ë…¸ë ˆí¬ í•˜ìœ„ í”„ë¡œì íŠ¸(project1/)ì˜ package.json/build.gradle ì°¾ì§€ ëª»í•¨

í•´ê²°:
  1. INSERT ì¿¼ë¦¬ì— working_directory ì»¬ëŸ¼ ì¶”ê°€
  2. VALUESì— ? í”Œë ˆì´ìŠ¤í™€ë” ì¶”ê°€ (13ê°œì—ì„œ 14ê°œë¡œ)
  3. .bind(&project.working_directory) ì¶”ê°€
íŒŒì¼: agent/src/db/queries.rs:89-110

ê´€ë ¨ ìˆ˜ì • ì´ë ¥:
  - 004_working_directory.sql ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
  - models.rsì— working_directory í•„ë“œ ì¶”ê°€ (Project, CreateProject)
  - docker/client.rsì—ì„œ WORKDIR ë™ì  ì„¤ì •
  - github/detector.rsì—ì„œ path_filterë¡œë¶€í„° working_directory ì¶”ì¶œ
  - build/executor.rsì—ì„œ working_directory ì „ë‹¬
  - frontend Setup.svelteì—ì„œ working_directory ì „ì†¡
  - api/projects.rsì—ì„œ working_directory ìˆ˜ì‹  ë° ì „ë‹¬
  - queries.rsì˜ migrate()ì— migration4 ì¶”ê°€

êµí›ˆ: ë°ì´í„° í”Œë¡œìš° ì „ì²´ë¥¼ í™•ì¸í•´ì•¼ í•¨ (Frontend â†’ API â†’ DB â†’ Build Executor â†’ Docker)

âŒ ë¬¸ì œ 10: í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ - stale data ë¬¸ì œ
--------------------------------------------------------------------------------
ì›ì¸: í—¬ìŠ¤ì²´í¬ì—ì„œ ì´ë¯¸ ì—…ë°ì´íŠ¸ëœ ì»¨í…Œì´ë„ˆ IDë¥¼ í™•ì¸í•˜ì§€ ëª»í•¨
ë°°ê²½:
  - ë°°í¬ í”Œë¡œìš°: ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘ â†’ DBì— ì»¨í…Œì´ë„ˆ ID ì €ì¥ â†’ í—¬ìŠ¤ì²´í¬ ìˆ˜í–‰
  - deployer.rsì˜ deploy() í•¨ìˆ˜ì—ì„œ project ë³€ìˆ˜ëŠ” í•¨ìˆ˜ ì‹œì‘ ì‹œì ì˜ ê°’
  - DBì— ìƒˆ ì»¨í…Œì´ë„ˆ IDë¥¼ ì—…ë°ì´íŠ¸í•´ë„ project ë³€ìˆ˜ëŠ” ì—¬ì „íˆ old ê°’ ìœ ì§€
  - í—¬ìŠ¤ì²´í¬ê°€ old ì»¨í…Œì´ë„ˆ IDë¥¼ ì²´í¬í•˜ì—¬ ì‹¤íŒ¨

ì¦ìƒ:
  - ìƒˆ ì»¨í…Œì´ë„ˆê°€ ì •ìƒ ì‹¤í–‰ ì¤‘ì¸ë°ë„ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨
  - active_slotì´ ì „í™˜ë˜ì§€ ì•ŠìŒ
  - í”„ë¡ì‹œ ì—°ê²° ì‹¤íŒ¨ (ì´ì „ ìŠ¬ë¡¯ì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ë¦¬í‚´)

ë¬¸ì œ ì½”ë“œ (deployer.rs):
```rust
// ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘
let container_id = self.docker.run_runtime_container(...).await?;

// DB ì—…ë°ì´íŠ¸
match target_slot {
    Slot::Blue => {
        self.state.db.update_project_blue_container(project.id, Some(container_id.clone())).await?;
    }
    ...
}

// âŒ ë¬¸ì œ: projectëŠ” ì—¬ì „íˆ old container_idë¥¼ ê°€ì§€ê³  ìˆìŒ
let health_check_result = self.perform_health_check(project, build, target_port).await;

// perform_health_check ë‚´ë¶€ì—ì„œ:
let container_id = match target_slot {
    Slot::Blue => project.blue_container_id.as_ref(), // âŒ old value
    ...
}
```

í•´ê²°:
  1. perform_health_checkì— container_idë¥¼ ì§ì ‘ ì „ë‹¬
  2. project ê°ì²´ì—ì„œ ì½ì§€ ì•Šê³  ì‹¤ì œ ìƒì„±ëœ container_id ì‚¬ìš©
  3. í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½:
     - Before: async fn perform_health_check(&self, project: &Project, build: &Build, port: u16)
     - After: async fn perform_health_check(&self, project: &Project, build: &Build, container_id: &str)

íŒŒì¼: agent/src/build/deployer.rs
  - Line 118-120: í—¬ìŠ¤ì²´í¬ í˜¸ì¶œ ì‹œ &container_id ì „ë‹¬
  - Line 252-310: perform_health_check í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë° ë‚´ë¶€ ë¡œì§ ìˆ˜ì •

êµí›ˆ:
  - In-memory ê°ì²´ì™€ DB ìƒíƒœì˜ ë™ê¸°í™” ì£¼ì˜
  - ì¤‘ìš”í•œ ê°’ì€ ì§ì ‘ ì „ë‹¬í•˜ì—¬ stale data ë¬¸ì œ ë°©ì§€
  - Rustì˜ ì†Œìœ ê¶Œ ì‹œìŠ¤í…œì€ ì´ëŸ° ë²„ê·¸ë¥¼ ì»´íŒŒì¼ íƒ€ì„ì— ì¡ì§€ ëª»í•¨ (ë…¼ë¦¬ ì˜¤ë¥˜)

âŒ ë¬¸ì œ 11: Active Slot ì „í™˜ ì‹¤íŒ¨ - í—¬ìŠ¤ì²´í¬ ì»¨í…ìŠ¤íŠ¸ íŒ¨ìŠ¤
--------------------------------------------------------------------------------
ì›ì¸: HTTP ê¸°ë°˜ í—¬ìŠ¤ì²´í¬ê°€ íŠ¹ì • URL ê²½ë¡œë¥¼ ê°€ì •
ë°°ê²½:
  - Spring Boot ì•±ì´ context pathë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (ì˜ˆ: /api/spring)
  - í—¬ìŠ¤ì²´í¬ URL: /actuator/health
  - ì‹¤ì œ URL: /api/spring/actuator/health
  - ê²°ê³¼: 404 Not Foundë¡œ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨

ì‚¬ìš©ì ì§ˆë¬¸: "context pathë¥¼ ì…ë ¥ë°›ê²Œ í•˜ìëŠ” ëœ»ì´ì˜€ì–´ ë¹Œë“œ ì„¤ì •ì°½ì—ì„œ. ì•„ë‹ˆë©´ í—¬ìŠ¤ì²´í¬ ë¡œì§ì„ ë°”ê¿€ê¹Œ. ê·¸ëƒ¥ ì»¨í…Œì´ë„ˆ ì˜ ë–´ëŠ”ì§€ ì²´í¬ê°™ì€ ëŠë‚Œìœ¼ë¡œ."

ì„ íƒ: í—¬ìŠ¤ì²´í¬ ë¡œì§ ë³€ê²½ (context path í•„ë“œ ì¶”ê°€í•˜ì§€ ì•ŠìŒ)

í•´ê²°:
  1. HTTP ìš”ì²­ ê¸°ë°˜ í—¬ìŠ¤ì²´í¬ ì œê±°
  2. Docker APIë¥¼ í†µí•œ ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ìœ¼ë¡œ ë³€ê²½
  3. is_container_running() ì‚¬ìš© (bollard API)
  4. 10íšŒ ì¬ì‹œë„, 2ì´ˆ ê°„ê²©
  5. Context path ì„¤ì • ë¶ˆí•„ìš”

ì¥ì :
  - ëª¨ë“  í”„ë ˆì„ì›Œí¬/ì–¸ì–´ì—ì„œ ë™ì‘ (ì–¸ì–´ ì¤‘ë¦½ì )
  - Context path, health check endpoint ì„¤ì • ë¶ˆí•„ìš”
  - ë‹¨ìˆœí•˜ê³  ëª…í™•í•œ ë¡œì§
  - ì»¨í…Œì´ë„ˆ ì‹œì‘ ì§í›„ ë°”ë¡œ í™•ì¸ ê°€ëŠ¥

íŒŒì¼: agent/src/build/deployer.rs:252-310
```rust
async fn perform_health_check(&self, project: &Project, build: &Build, container_id: &str) -> Result<()> {
    let max_attempts = 10;
    let retry_interval = Duration::from_secs(2);

    for attempt in 1..=max_attempts {
        // Docker APIë¡œ ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
        let is_running = self.docker.is_container_running(&container_id).await;

        if is_running {
            info!("Container health check passed on attempt {}/{} - Container is running", attempt, max_attempts);
            return Ok(());
        }

        if attempt < max_attempts {
            sleep(retry_interval).await;
        }
    }

    anyhow::bail!("Health check timed out after {} attempts", max_attempts)
}
```

êµí›ˆ:
  - ë³µì¡í•œ ì„¤ì •ë³´ë‹¤ ë‹¨ìˆœí•œ í•´ê²°ì±… ì„ í˜¸
  - ì–¸ì–´/í”„ë ˆì„ì›Œí¬ ì¤‘ë¦½ì ì¸ ë°©ì‹ ì„ íƒ
  - ì‚¬ìš©ì ê²½í—˜ ìš°ì„  (ì¶”ê°€ ì„¤ì • ìµœì†Œí™”)

âŒ ë¬¸ì œ 12: ì»¨í…Œì´ë„ˆ ìƒíƒœ ë¶ˆì¼ì¹˜ - ì‹œìŠ¤í…œ ì¬ì‹œì‘ í›„
--------------------------------------------------------------------------------
ì›ì¸: ì‹œìŠ¤í…œ ì¬ì‹œì‘ í›„ DBì— ì €ì¥ëœ ì»¨í…Œì´ë„ˆ IDê°€ ì‹¤ì œë¡œëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŒ
ë°°ê²½:
  - Agent ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (docker-compose restart)
  - Runtime ì»¨í…Œì´ë„ˆë“¤ì€ ì‚­ì œë¨
  - DBì—ëŠ” ì—¬ì „íˆ ì‚­ì œëœ ì»¨í…Œì´ë„ˆ ID ì €ì¥
  - ë°°í¬ ì‹œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì°¸ì¡°í•˜ì—¬ ì—ëŸ¬

ì¦ìƒ:
  - "Project 'xxx': Blue container abc123 not found, skipping cleanup"
  - Orphaned container references in database
  - ë°°í¬ ì‹œ ë¶ˆí•„ìš”í•œ ì—ëŸ¬ ë¡œê·¸

í•´ê²°:
  1. ì‹œìŠ¤í…œ ì‹œì‘ ì‹œ ì»¨í…Œì´ë„ˆ ìƒíƒœ ë™ê¸°í™” í•¨ìˆ˜ ì¶”ê°€
  2. ëª¨ë“  í”„ë¡œì íŠ¸ì˜ blue/green ì»¨í…Œì´ë„ˆ í™•ì¸
  3. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¨í…Œì´ë„ˆ IDëŠ” DBì—ì„œ ì œê±°
  4. ê¹”ë”í•œ ì´ˆê¸° ìƒíƒœë¡œ ì‹œì‘

íŒŒì¼: agent/src/main.rs
```rust
// Line 79-82: ì‹œì‘ ì‹œ ë™ê¸°í™” í˜¸ì¶œ
info!("Synchronizing container states...");
synchronize_container_states(&state, &docker).await?;
info!("Container state synchronization complete");

// Line 163-200: ë™ê¸°í™” í•¨ìˆ˜
async fn synchronize_container_states(state: &AppState, docker: &DockerClient) -> Result<()> {
    let projects = state.db.list_projects().await?;

    for project in projects {
        let mut needs_update = false;
        let mut new_blue_id = project.blue_container_id.clone();
        let mut new_green_id = project.green_container_id.clone();

        // Check Blue container
        if let Some(blue_id) = &project.blue_container_id {
            if !docker.is_container_running(blue_id).await {
                info!("Project '{}': Blue container {} not found, clearing from DB", project.name, blue_id);
                new_blue_id = None;
                needs_update = true;
            }
        }

        // Check Green container
        if let Some(green_id) = &project.green_container_id {
            if !docker.is_container_running(green_id).await {
                info!("Project '{}': Green container {} not found, clearing from DB", project.name, green_id);
                new_green_id = None;
                needs_update = true;
            }
        }

        // Update database if needed
        if needs_update {
            state.db.update_project_blue_container(project.id, new_blue_id).await?;
            state.db.update_project_green_container(project.id, new_green_id).await?;
            info!("Project '{}': Container states synchronized", project.name);
        }
    }

    Ok(())
}
```

êµí›ˆ:
  - ì˜ì†ì„± ë ˆì´ì–´(DB)ì™€ ì‹¤ì œ ë¦¬ì†ŒìŠ¤(ì»¨í…Œì´ë„ˆ) ìƒíƒœ ë™ê¸°í™” ì¤‘ìš”
  - ì‹œìŠ¤í…œ ì‹œì‘ ì‹œ ì¼ê´€ì„± ê²€ì¦ í•„ìš”
  - Garbage collection ê°™ì€ ì •ë¦¬ ì‘ì—… ìë™í™”

âŒ ë¬¸ì œ 13: ë°°í¬ ì‹¤íŒ¨ - íƒ€ê²Ÿ ìŠ¬ë¡¯ì— ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¡´ì¬
--------------------------------------------------------------------------------
ì›ì¸: íƒ€ê²Ÿ ìŠ¬ë¡¯ì— ê¸°ì¡´ ì»¨í…Œì´ë„ˆê°€ ë‚¨ì•„ìˆì–´ í¬íŠ¸ ì¶©ëŒ
ë°°ê²½:
  - ì´ì „ ë°°í¬ê°€ ì‹¤íŒ¨í•œ ê²½ìš°
  - í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ë¡œ ë¡¤ë°±í•˜ì§€ ì•Šì€ ê²½ìš° (ë””ë²„ê¹… ëª¨ë“œ)
  - íƒ€ê²Ÿ ìŠ¬ë¡¯ì— ì´ë¯¸ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ì¤‘
  - ë™ì¼í•œ í¬íŠ¸ë¡œ ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œë„ â†’ í¬íŠ¸ ì¶©ëŒ

ì‚¬ìš©ì ìš”êµ¬ì‚¬í•­: "ê·¸ë˜ ë¬´ì¡°ê±´ 2ê°œ ë‹¨ìœ„ë¡œ í• ë‹¹í•˜ê³  ê·¸ê±¸ DBì ìœ¼ë¡œ ê´€ë¦¬í•´ë³´ì. ê³ ì³ì¤˜."

í•´ê²°:
  1. ë°°í¬ ì‹œì‘ ì „ì— íƒ€ê²Ÿ ìŠ¬ë¡¯ ì •ë¦¬
  2. ê¸°ì¡´ ì»¨í…Œì´ë„ˆ í™•ì¸ â†’ ì¤‘ì§€ â†’ ì œê±°
  3. DBì—ì„œ ì»¨í…Œì´ë„ˆ ID ì œê±°
  4. ê¹”ë”í•œ ìƒíƒœì—ì„œ ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘

íŒŒì¼: agent/src/build/deployer.rs:57-83
```rust
// Clean up target slot's old container if it exists
let old_container_id = match target_slot {
    Slot::Blue => project.blue_container_id.as_ref(),
    Slot::Green => project.green_container_id.as_ref(),
};

if let Some(old_id) = old_container_id {
    // Check if container actually exists
    if self.docker.is_container_running(old_id).await {
        info!("Stopping old {} container: {}", target_slot, old_id);
        self.docker.stop_container(old_id).await.ok();
    } else {
        info!("Old {} container {} not found, skipping cleanup", target_slot, old_id);
    }
    // Always try to remove regardless of running state
    self.docker.remove_container(old_id).await.ok();

    // Clear from database
    match target_slot {
        Slot::Blue => {
            self.state.db.update_project_blue_container(project.id, None).await?;
        }
        Slot::Green => {
            self.state.db.update_project_green_container(project.id, None).await?;
        }
    }
}
```

ë¸”ë£¨-ê·¸ë¦° ê´€ë¦¬ 3ë‹¨ê³„ ë³´í˜¸:
  1. í”„ë¡œì íŠ¸ ìƒì„±: active_slot='Blue', container_ids=NULL
  2. ì‹œìŠ¤í…œ ì‹œì‘: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¨í…Œì´ë„ˆ DB ì •ë¦¬
  3. ë°°í¬ ì „: íƒ€ê²Ÿ ìŠ¬ë¡¯ ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì •ë¦¬

êµí›ˆ:
  - Idempotent operations (ë©±ë“±ì„±) ì¤‘ìš”
  - í•­ìƒ ê¹¨ë—í•œ ìƒíƒœì—ì„œ ì‹œì‘
  - ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ ê³ ë ¤í•œ robustí•œ ì„¤ê³„
  - DBì™€ ì‹¤ì œ ë¦¬ì†ŒìŠ¤ì˜ ì¼ê´€ì„± ìœ ì§€

ğŸš€ ë°°í¬ ì™„ë£Œ
--------------------------------------------------------------------------------
Docker Hub: choho97/lightweight-ci:latest (sha256:02de4a05b4a3...)
Git Commit: d2b1b04 (2026-01-08)
ì»¨í…Œì´ë„ˆ: ì •ìƒ ì‹¤í–‰ ì¤‘
ì‹œìŠ¤í…œ: ì»¨í…Œì´ë„ˆ ìƒíƒœ ë™ê¸°í™” ì™„ë£Œ
í—¬ìŠ¤ì²´í¬: Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
ë¸”ë£¨-ê·¸ë¦°: 3ë‹¨ê³„ ë³´í˜¸ ì²´ê³„ êµ¬ì¶• ì™„ë£Œ

ğŸ“‹ ì‹¤í–‰ ë°©ë²•
--------------------------------------------------------------------------------
1. docker-compose up -d
2. http://localhost:10000 ì ‘ì† (ì›¹ UI)
3. http://localhost:9999/{project_name} (ë°°í¬ëœ ì•±)
4. GET /api/settings/webhook-secretë¡œ Webhook Secret í™•ì¸

ğŸ” ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ëª…ë ¹ì–´
--------------------------------------------------------------------------------
# Gateway IP í™•ì¸
docker network inspect easycicd_easycicd | jq '.[0].IPAM.Config[0].Gateway'

# Agent IP í™•ì¸
docker inspect easycicd-agent | jq '.[0].NetworkSettings.Networks.easycicd_easycicd.IPAddress'

# Runtime ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker inspect tt-green | jq '.[0].NetworkSettings.Networks | keys'

# í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸
curl http://localhost:9999/tt/
