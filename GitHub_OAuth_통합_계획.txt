================================================================================
GitHub OAuth í†µí•© ê³„íš
================================================================================
ì‘ì„±ì¼: 2026-01-07

ğŸ“‹ ëª©í‘œ
--------------------------------------------------------------------------------
- GitHub ì†Œì…œ ë¡œê·¸ì¸ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì¦
- ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ë ˆí¬ì§€í† ë¦¬ ìë™ ëª©ë¡í™”
- ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë ˆí¬ì§€í† ë¦¬ ì„ íƒ (URL ìˆ˜ë™ ì…ë ¥ ë¶ˆí•„ìš”)
- GitHub Webhook ìë™ ìƒì„± ë° ì—°ê²°

ğŸ” Phase 1: GitHub OAuth ì¸ì¦
--------------------------------------------------------------------------------
[F] GitHub OAuth App ë“±ë¡ (ìˆ˜ë™ ì‘ì—…)
    - Settings â†’ Developer settings â†’ OAuth Apps
    - Application name: Easy CI/CD
    - Homepage URL: http://localhost:10000
    - Authorization callback URL: http://localhost:10000/auth/github/callback
    - Client ID, Client Secret ë°œê¸‰

[F] OAuth ì„¤ì • ì €ì¥ (DB)
    - settings í…Œì´ë¸”ì— github_oauth_client_id, github_oauth_client_secret ì €ì¥
    - í™˜ê²½ë³€ìˆ˜ ëŒ€ì‹  DBì— ì €ì¥ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
    - API: GET/POST /api/settings/github-oauth

[F] ë°±ì—”ë“œ: OAuth í”Œë¡œìš° êµ¬í˜„
    - GET /auth/github - GitHub ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
    - GET /auth/github/callback - GitHubì—ì„œ ëŒì•„ì˜¬ ë•Œ ì²˜ë¦¬
    - OAuth ìŠ¤ì½”í”„: repo, admin:repo_hook (ë ˆí¬ ì ‘ê·¼ + Webhook ìƒì„±)
    - Access Token ë°œê¸‰ ë° ì €ì¥

[F] ì‚¬ìš©ì ì„¸ì…˜ ê´€ë¦¬
    - users í…Œì´ë¸” ìƒì„± (id, github_id, github_username, access_token, created_at)
    - ì„¸ì…˜ ì¿ í‚¤ ë˜ëŠ” JWT í† í° ë°œê¸‰
    - ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€

ğŸ—‚ï¸ Phase 2: ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
--------------------------------------------------------------------------------
[F] GitHub API ì—°ë™
    - GET https://api.github.com/user/repos
    - Authorization: Bearer {access_token}
    - íŒŒë¼ë¯¸í„°: affiliation=owner,collaborator&sort=updated&per_page=100
    - ì‚¬ìš©ìê°€ ownerì´ê±°ë‚˜ collaboratorì¸ ë ˆí¬ë§Œ ê°€ì ¸ì˜¤ê¸°

[F] ë°±ì—”ë“œ API
    - GET /api/github/repos
    - ì¸ì¦ëœ ì‚¬ìš©ìì˜ access_tokenìœ¼ë¡œ GitHub API í˜¸ì¶œ
    - ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ ë°˜í™˜ (name, full_name, clone_url, default_branch)
    - ìºì‹± (5ë¶„) - ë§¤ë²ˆ GitHub API í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡

[F] í”„ë¡ íŠ¸ì—”ë“œ: ë ˆí¬ ì„ íƒ UI
    - Setup í˜ì´ì§€ì—ì„œ "GitHubì—ì„œ ì„ íƒ" ë²„íŠ¼
    - ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ê²€ìƒ‰ ê°€ëŠ¥í•œ ëª¨ë‹¬
    - ì„ íƒ ì‹œ repo í•„ë“œ ìë™ ì…ë ¥ (clone_url)
    - branch í•„ë“œë„ default_branchë¡œ ìë™ ì…ë ¥

ğŸª Phase 3: Webhook ìë™ ìƒì„±
--------------------------------------------------------------------------------
[F] Webhook ìƒì„± API
    - POST /api/projects í˜¸ì¶œ ì‹œ ìë™ìœ¼ë¡œ Webhook ìƒì„±
    - GitHub API: POST /repos/{owner}/{repo}/hooks
    - Payload URL: http://{ì„œë²„ì£¼ì†Œ}/webhook/github
    - Content type: application/json
    - Secret: DBì— ì €ì¥ëœ webhook_secret ì‚¬ìš©
    - Events: ["push"] (ë‚˜ì¤‘ì— pull_request ì¶”ê°€ ê°€ëŠ¥)

[F] Webhook ìƒì„± ê¶Œí•œ í™•ì¸
    - OAuth ìŠ¤ì½”í”„ì— admin:repo_hook í¬í•¨ë˜ì–´ì•¼ í•¨
    - ê¶Œí•œ ì—†ìœ¼ë©´ ìˆ˜ë™ Webhook ì„¤ì • ì•ˆë‚´ ë©”ì‹œì§€

[F] Webhook ì‚­ì œ
    - DELETE /api/projects/:id í˜¸ì¶œ ì‹œ GitHub Webhookë„ ì‚­ì œ
    - webhook_idë¥¼ projects í…Œì´ë¸”ì— ì €ì¥

ğŸ“Š Phase 4: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½
--------------------------------------------------------------------------------
[F] users í…Œì´ë¸” ìƒì„±
    CREATE TABLE users (
        id INTEGER PRIMARY KEY,
        github_id INTEGER UNIQUE NOT NULL,
        github_username TEXT NOT NULL,
        github_avatar_url TEXT,
        access_token TEXT NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now'))
    );

[F] projects í…Œì´ë¸” ìˆ˜ì •
    - user_id INTEGER ì»¬ëŸ¼ ì¶”ê°€ (FK to users.id)
    - github_webhook_id INTEGER ì»¬ëŸ¼ ì¶”ê°€
    - ë ˆí¬ì§€í† ë¦¬ì™€ ì‚¬ìš©ì ì—°ê²°

[F] ë§ˆì´ê·¸ë ˆì´ì…˜
    - migrations/003_github_oauth.sql ìƒì„±

ğŸ¨ Phase 5: í”„ë¡ íŠ¸ì—”ë“œ UI ê°œì„ 
--------------------------------------------------------------------------------
[F] ë¡œê·¸ì¸ í˜ì´ì§€
    - "GitHubë¡œ ë¡œê·¸ì¸" ë²„íŠ¼
    - ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš° Setup í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨
    - ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ (ìš°ì¸¡ ìƒë‹¨ì— GitHub ì•„ë°”íƒ€)

[F] Setup í˜ì´ì§€ ê°œì„ 
    - Repository í•„ë“œ:
      - "GitHubì—ì„œ ì„ íƒ" ë²„íŠ¼
      - ë˜ëŠ” ìˆ˜ë™ ì…ë ¥ (GitHub ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš°)
    - Branch í•„ë“œ: ìë™ ì…ë ¥ (ì„ íƒí•œ ë ˆí¬ì˜ default_branch)
    - Webhook ìë™ ìƒì„± ì•ˆë‚´ ë©”ì‹œì§€

[F] Dashboard í˜ì´ì§€
    - ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì¶”ê°€
    - í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ

ğŸ”§ Phase 6: ë°±ì—”ë“œ êµ¬í˜„ ìƒì„¸
--------------------------------------------------------------------------------
[F] Dependencies ì¶”ê°€ (Cargo.toml)
    - reqwest = { version = "0.12", features = ["json"] } # GitHub API í˜¸ì¶œ
    - jsonwebtoken = "9" # JWT í† í° (ì„ íƒ)

[F] GitHub OAuth ëª¨ë“ˆ (agent/src/github/)
    - agent/src/github/mod.rs
    - agent/src/github/oauth.rs - OAuth í”Œë¡œìš°
    - agent/src/github/api.rs - GitHub API í´ë¼ì´ì–¸íŠ¸
    - agent/src/github/webhook.rs - Webhook ìƒì„±/ì‚­ì œ

[F] API ì—”ë“œí¬ì¸íŠ¸ (agent/src/api/auth.rs)
    - GET /auth/github - GitHub ë¡œê·¸ì¸ ì‹œì‘
    - GET /auth/github/callback - OAuth ì½œë°± ì²˜ë¦¬
    - GET /api/auth/me - í˜„ì¬ ì‚¬ìš©ì ì •ë³´
    - POST /api/auth/logout - ë¡œê·¸ì•„ì›ƒ

[F] API ì—”ë“œí¬ì¸íŠ¸ (agent/src/api/github_repos.rs)
    - GET /api/github/repos - ì‚¬ìš©ì ë ˆí¬ì§€í† ë¦¬ ëª©ë¡

[F] ë¯¸ë“¤ì›¨ì–´: ì¸ì¦ í™•ì¸
    - ë¡œê·¸ì¸ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ì— ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€
    - ì„¸ì…˜ ì¿ í‚¤ ë˜ëŠ” Authorization í—¤ë” í™•ì¸

ğŸš€ Phase 7: ë°°í¬ ì„¤ì •
--------------------------------------------------------------------------------
[F] OAuth ì„¤ì • UI
    - Settings í˜ì´ì§€ ì¶”ê°€
    - GitHub OAuth Client ID/Secret ì…ë ¥ í¼
    - Webhook Secret í‘œì‹œ (ì½ê¸° ì „ìš©)

[F] í™˜ê²½ë³„ Callback URL
    - ê°œë°œ: http://localhost:10000/auth/github/callback
    - í”„ë¡œë•ì…˜: http://{ì‹¤ì œë„ë©”ì¸}/auth/github/callback
    - DBì— base_url ì„¤ì • ì €ì¥

[F] HTTPS ê³ ë ¤ì‚¬í•­
    - GitHub OAuthëŠ” localhost ì™¸ì—ëŠ” HTTPS í•„ìˆ˜
    - í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ(Nginx) + Let's Encrypt

âš ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
--------------------------------------------------------------------------------
[F] Access Token ì•”í˜¸í™”
    - DBì— ì €ì¥í•  ë•Œ ì•”í˜¸í™” (AES-256)
    - ë³µí˜¸í™” í‚¤ëŠ” í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ë³„ë„ ê´€ë¦¬

[F] CSRF ë°©ì§€
    - OAuth state íŒŒë¼ë¯¸í„° ì‚¬ìš©
    - ì„¸ì…˜ì— state ì €ì¥ í›„ ì½œë°±ì—ì„œ ê²€ì¦

[F] Rate Limiting
    - GitHub APIëŠ” ì¸ì¦ëœ ìš”ì²­ 5000/hour
    - ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ ìºì‹±ìœ¼ë¡œ API í˜¸ì¶œ ìµœì†Œí™”

ğŸ“ êµ¬í˜„ ìš°ì„ ìˆœìœ„
--------------------------------------------------------------------------------
1ë‹¨ê³„ (í•„ìˆ˜):
  - Phase 1: OAuth ì¸ì¦ (ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ)
  - Phase 2: ë ˆí¬ì§€í† ë¦¬ ëª©ë¡
  - Phase 4: DB ìŠ¤í‚¤ë§ˆ
  - Phase 5: í”„ë¡ íŠ¸ì—”ë“œ UI

2ë‹¨ê³„ (ê¶Œì¥):
  - Phase 3: Webhook ìë™ ìƒì„±
  - Phase 7: ë°°í¬ ì„¤ì •

3ë‹¨ê³„ (ì„ íƒ):
  - Access Token ì•”í˜¸í™”
  - HTTPS ì„¤ì •

ğŸ¤” ëŒ€ì•ˆ: ê°„ì†Œí™” ë²„ì „
--------------------------------------------------------------------------------
ë§Œì•½ OAuthê°€ ê³¼ë„í•˜ë‹¤ë©´:
- GitHub Personal Access Token ì…ë ¥ë°›ê¸°
  - ì‚¬ìš©ìê°€ ì§ì ‘ PAT ìƒì„± (Settings â†’ Developer settings â†’ Personal access tokens)
  - ìŠ¤ì½”í”„: repo, admin:repo_hook
  - Setup í˜ì´ì§€ì—ì„œ PAT ì…ë ¥
  - DBì— ì•”í˜¸í™”í•˜ì—¬ ì €ì¥
  - ë ˆí¬ ëª©ë¡ ì¡°íšŒ, Webhook ìƒì„±ì€ ë™ì¼í•˜ê²Œ êµ¬í˜„

ì¥ì : OAuth í”Œë¡œìš° ì—†ì´ ë¹ ë¥´ê²Œ êµ¬í˜„ ê°€ëŠ¥
ë‹¨ì : ì‚¬ìš©ìê°€ PAT ìƒì„± ê³¼ì •ì„ ì•Œì•„ì•¼ í•¨

================================================================================
ì¶”ì²œ ë°©í–¥: OAuth ì „ì²´ êµ¬í˜„ (1-2ë‹¨ê³„)
ì´ìœ : ì‚¬ìš©ì ê²½í—˜ì´ í›¨ì”¬ ì¢‹ê³ , í”„ë¡œë•ì…˜ ìˆ˜ì¤€ì˜ ì•±ì— ì í•©
